<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Authentication Test - Trinkaspace</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../assets/css/core.css">
  <link rel="stylesheet" href="../../assets/css/user-interface.css">
  <style>
    body {
      background: #333344;
      color: #ACABBB;
      font-family: 'Noto Sans', sans-serif;
      margin: 0;
      padding: 20px;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      margin-bottom: 30px;
    }
    
    h1 {
      color: #2AFFF7;
      text-align: center;
      margin-bottom: 40px;
    }
    
    .back-btn {
      color: #2AFFF7;
      background: none;
      border: none;
      font-size: 1em;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .back-btn:hover {
      text-decoration: underline;
    }
    
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #252535;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    
    h2 {
      color: #2AFFF7;
      margin-top: 0;
    }
    
    .user-info-display {
      background: #1F1F2F;
      border-left: 4px solid #2AFFF7;
      padding: 15px;
      margin: 15px 0;
      font-family: monospace;
    }
    
    .test-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .test-button {
      background: #161670;
      color: #ACABBB;
      border: none;
      border-radius: 6px;
      padding: 8px 15px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.2s ease;
    }
    
    .test-button:hover {
      background: #2626a0;
      transform: scale(1.05);
    }
    
    .bookmark-section {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 15px;
      background: rgba(42, 255, 247, 0.1);
      border: 1px solid rgba(42, 255, 247, 0.3);
      border-radius: 6px;
      margin: 10px 0;
      cursor: pointer;
    }
    
    .bookmark-section:hover {
      background: rgba(42, 255, 247, 0.2);
    }
    
    .bookmark-section h3 {
      margin: 0;
      color: #2AFFF7;
    }
    
    .bookmark-icon {
      font-size: 1.5em;
    }
    
    /* Theme testing */
    .theme-preview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .theme-card {
      padding: 15px;
      border-radius: 8px;
    }
    
    .theme-default {
      background: #252535;
      color: #ACABBB;
    }
    
    .theme-forest {
      background: #2a3a2a;
      color: #b0c8b0;
    }
    
    .theme-night {
      background: #0F0F20;
      color: #9898b0;
    }
    
    .theme-sunset {
      background: #402030;
      color: #c8b0b8;
    }
  </style>
</head>
<body>
  <header>
    <button onclick="location.href='../../portal.html'" class="back-btn">← Back to Portal</button>
    <div id="trinkaspace-user-display" class="trinkaspace-user-area">
      <!-- User interface will be injected here by userManager.js -->
    </div>
  </header>
  
  <h1>User Authentication System Test</h1>
  
  <div class="test-container">
    <div class="test-section">
      <h2>Current User Status</h2>
      <div id="current-user-info" class="user-info-display">
        Loading user info...
      </div>
      <div class="test-actions">
        <button class="test-button" id="test-user-status">Refresh User Status</button>
      </div>
    </div>
    
    <div class="test-section">
      <h2>Bookmarking Test</h2>
      <p>Click on a section below to bookmark it. These demonstrate how content can be bookmarked.</p>
      
      <div class="bookmark-section" data-section-id="test-section-1" data-section-title="Introduction Section">
        <span class="bookmark-icon">☆</span>
        <div>
          <h3>Introduction Section</h3>
          <p>This is an example of content that could be bookmarked.</p>
        </div>
      </div>
      
      <div class="bookmark-section" data-section-id="test-section-2" data-section-title="Character Development">
        <span class="bookmark-icon">☆</span>
        <div>
          <h3>Character Development</h3>
          <p>Important character moment that readers might want to return to later.</p>
        </div>
      </div>
      
      <div class="bookmark-section" data-section-id="test-section-3" data-section-title="Plot Twist">
        <span class="bookmark-icon">☆</span>
        <div>
          <h3>Plot Twist</h3>
          <p>A surprising revelation in the story that changes everything!</p>
        </div>
      </div>
      
      <div id="bookmarks-list" class="user-info-display">
        Your bookmarks will appear here...
      </div>
    </div>
    
    <div class="test-section">
      <h2>Theme Preferences Test</h2>
      <p>Click the buttons below to preview different themes. Your preference will be saved if you're logged in.</p>
      
      <div class="test-actions">
        <button class="test-button" data-theme="default">Default Theme</button>
        <button class="test-button" data-theme="forest">Forest Theme</button>
        <button class="test-button" data-theme="night">Night Theme</button>
        <button class="test-button" data-theme="sunset">Sunset Theme</button>
      </div>
      
      <div class="theme-preview">
        <div class="theme-card theme-default">
          <h3>Default Theme</h3>
          <p>The standard Trinkaspace theme.</p>
        </div>
        <div class="theme-card theme-forest">
          <h3>Forest Theme</h3>
          <p>A calming green-based theme.</p>
        </div>
        <div class="theme-card theme-night">
          <h3>Night Theme</h3>
          <p>Dark blue theme for night reading.</p>
        </div>
        <div class="theme-card theme-sunset">
          <h3>Sunset Theme</h3>
          <p>Purple-red tones for a dramatic feel.</p>
        </div>
      </div>
    </div>
  </div>
  
  <script type="module">
    import userManager from '../../assets/js/userManager.js';
    import { initUserInterface } from '../../assets/js/userIntegration.js';
    
    // Initialize user interface
    document.addEventListener('DOMContentLoaded', () => {
      initUserInterface({
        pageId: 'user-auth-test',
        pageTitle: 'User Authentication Test',
        enableBookmarking: true
      });
      
      // Update user info display
      updateUserInfo();
      updateBookmarks();
      
      // Set up event listeners
      document.getElementById('test-user-status').addEventListener('click', updateUserInfo);
      
      // Set up bookmark section event listeners
      document.querySelectorAll('.bookmark-section').forEach(section => {
        section.addEventListener('click', function() {
          if (!userManager.isUserLoggedIn()) {
            alert('Please log in to bookmark content');
            return;
          }
          
          const sectionId = this.dataset.sectionId;
          const sectionTitle = this.dataset.sectionTitle;
          const iconElement = this.querySelector('.bookmark-icon');
          
          // Check if already bookmarked
          const bookmarks = userManager.getBookmarks();
          const isBookmarked = bookmarks.some(b => b.id === sectionId);
          
          if (isBookmarked) {
            userManager.removeBookmark(sectionId);
            iconElement.textContent = '☆';
          } else {
            userManager.saveBookmark(sectionId, sectionTitle, { 
              url: window.location.href + '#' + sectionId 
            });
            iconElement.textContent = '★';
          }
          
          // Update bookmarks display
          updateBookmarks();
        });
      });
      
      // Set up theme test buttons
      document.querySelectorAll('.test-button[data-theme]').forEach(button => {
        button.addEventListener('click', function() {
          const theme = this.dataset.theme;
          document.body.setAttribute('data-theme', theme);
          
          if (userManager.isUserLoggedIn()) {
            userManager.savePreferences({ theme: theme });
          }
        });
      });
      
      // Listen for login/logout events
      document.addEventListener('trinkaspace-user-login', () => {
        updateUserInfo();
        updateBookmarks();
        updateBookmarkIcons();
      });
      
      document.addEventListener('trinkaspace-user-logout', () => {
        updateUserInfo();
        updateBookmarks();
        resetBookmarkIcons();
      });
      
      // Update bookmark icons based on user bookmarks
      updateBookmarkIcons();
    });
    
    function updateUserInfo() {
      const userInfoElement = document.getElementById('current-user-info');
      
      if (userManager.isUserLoggedIn()) {
        const user = userManager.getCurrentUser();
        userInfoElement.innerHTML = `
          <p><strong>Status:</strong> Logged In</p>
          <p><strong>Username:</strong> ${user.username}</p>
          <p><strong>Email:</strong> ${user.email}</p>
          <p><strong>Created:</strong> ${new Date(user.created).toLocaleString()}</p>
          <p><strong>Last Login:</strong> ${new Date(user.lastLogin).toLocaleString()}</p>
        `;
      } else {
        userInfoElement.innerHTML = `
          <p><strong>Status:</strong> Not Logged In</p>
          <p>Please log in or register to test user functionality.</p>
        `;
      }
    }
    
    function updateBookmarks() {
      const bookmarksElement = document.getElementById('bookmarks-list');
      
      if (userManager.isUserLoggedIn()) {
        const bookmarks = userManager.getBookmarks();
        
        if (bookmarks.length === 0) {
          bookmarksElement.innerHTML = `<p>You have no bookmarks yet. Click on a section above to bookmark it.</p>`;
        } else {
          let bookmarksList = '<p><strong>Your Bookmarks:</strong></p><ul>';
          bookmarks.forEach(bookmark => {
            bookmarksList += `
              <li>
                <a href="${bookmark.metadata?.url || '#'}">${bookmark.title}</a>
                <small>(${new Date(bookmark.timestamp).toLocaleDateString()})</small>
              </li>
            `;
          });
          bookmarksList += '</ul>';
          bookmarksElement.innerHTML = bookmarksList;
        }
      } else {
        bookmarksElement.innerHTML = `<p>Please log in to save and view bookmarks.</p>`;
      }
    }
    
    function updateBookmarkIcons() {
      if (!userManager.isUserLoggedIn()) {
        resetBookmarkIcons();
        return;
      }
      
      const bookmarks = userManager.getBookmarks();
      
      document.querySelectorAll('.bookmark-section').forEach(section => {
        const sectionId = section.dataset.sectionId;
        const isBookmarked = bookmarks.some(b => b.id === sectionId);
        const iconElement = section.querySelector('.bookmark-icon');
        
        if (isBookmarked && iconElement) {
          iconElement.textContent = '★';
        }
      });
    }
    
    function resetBookmarkIcons() {
      document.querySelectorAll('.bookmark-section .bookmark-icon').forEach(icon => {
        icon.textContent = '☆';
      });
    }
  </script>
</body>
</html>
