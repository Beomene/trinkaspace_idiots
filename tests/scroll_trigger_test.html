<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trinkatext Scroll Trigger Test</title>
    <link rel="stylesheet" href="../../assets/css/core.css">
    <style>
        body {
            background-color: #202029;
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .test-container {
            width: 100%;
            min-height: 10000px; /* Same as pageHeight in page.json */
            position: relative;
        }
        
        .scroll-marker {
            position: absolute;
            width: 100%;
            padding: 1rem;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.3);
            border-left: 5px solid rgba(42, 255, 247, 0.6);
        }
        
        .test-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            text-align: center;
            z-index: 9000;
        }
        
        .scroll-position {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: monospace;
        }
        
        /* Minimap showing scroll markers */
        .scroll-minimap {
            position: fixed;
            right: 20px;
            top: 100px;
            width: 20px;
            height: 400px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .minimap-marker {
            position: absolute;
            width: 100%;
            height: 5px;
            background-color: rgba(42, 255, 247, 0.6);
            border-radius: 2px;
            left: 0;
        }
        
        .minimap-viewport {
            position: absolute;
            width: 20px;
            height: 40px; /* 10000px / 400px * viewport height */
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            left: 0;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>TRINKATEXT Scroll Trigger Test</h1>
        <p>Scroll down to see messages appear in the TRINKATEXT HUD element</p>
    </div>
    
    <div class="test-container" id="trinkaspace-container">
        <!-- Scroll markers at the same positions as triggers in page.json -->
        <div class="scroll-marker" style="top: 0px;">Trigger: Welcome message (y=0)</div>
        <div class="scroll-marker" style="top: 1800px;">Trigger: First diorama approach (y=1800)</div>
        <div class="scroll-marker" style="top: 2222px;">Trigger: First diorama view (y=2222)</div>
        <div class="scroll-marker" style="top: 3500px;">Trigger: Midway (y=3500)</div>
        <div class="scroll-marker" style="top: 4444px;">Trigger: Second diorama view (y=4444)</div>
        <div class="scroll-marker" style="top: 6000px;">Trigger: Third diorama approach (y=6000)</div>
        <div class="scroll-marker" style="top: 6666px;">Trigger: Third diorama view (y=6666)</div>
        <div class="scroll-marker" style="top: 8000px;">Trigger: Conclusion (y=8000)</div>
    </div>
    
    <div class="scroll-position" id="scroll-position">Y: 0px</div>
    
    <div class="scroll-minimap" id="scroll-minimap">
        <!-- Minimap markers will be added dynamically -->
        <div class="minimap-viewport" id="minimap-viewport"></div>
    </div>
    
    <script type="module">
        import TrinkaspaceEngine from '../../assets/js/trinkaspaceEngine.js';
        
        // Initialize the engine
        const engine = new TrinkaspaceEngine({
            pageId: 'scroll_trigger_test'
        });
        
        // Mock page.json data - these match the markers in the HTML
        const scrollTriggers = [
            {
                y: 0,
                message: "Welcome to Trinkaspace. Scroll down to explore the story.",
                id: "intro",
                once: false
            },
            {
                y: 1800,
                message: "The first diorama comes into view...",
                id: "diorama-1-approach",
                once: true
            },
            {
                y: 2222,
                message: "You've reached the first diorama. Take a moment to observe.",
                id: "diorama-1-view",
                delay: 500,
                once: true
            },
            {
                y: 3500,
                message: "Continuing your journey through the narrative...",
                id: "midway",
                once: false
            },
            {
                y: 4444,
                message: "The second diorama reveals new details about the story.",
                id: "diorama-2-view",
                delay: 500,
                once: true
            },
            {
                y: 6000,
                message: "As you approach the final diorama, consider what you've learned.",
                id: "diorama-3-approach",
                once: true
            },
            {
                y: 6666,
                message: "The final diorama ties everything together.",
                id: "diorama-3-view",
                delay: 500,
                once: true
            },
            {
                y: 8000,
                message: "You've reached the end of this chapter. What mysteries await in the next?",
                id: "conclusion",
                once: true
            }
        ];
        
        // Add scroll triggers after a short delay to ensure engine is initialized
        setTimeout(() => {
            engine.addTextTriggers(scrollTriggers);
            console.log('Added scroll triggers for testing');
            
            // Create minimap markers
            const minimapHeight = 400; // height of the minimap in pixels
            const pageHeight = 10000;  // height of the page in pixels
            const minimap = document.getElementById('scroll-minimap');
            
            scrollTriggers.forEach(trigger => {
                const marker = document.createElement('div');
                marker.className = 'minimap-marker';
                marker.style.top = `${(trigger.y / pageHeight) * minimapHeight}px`;
                minimap.appendChild(marker);
            });
            
            // Update scroll position indicator and minimap viewport
            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY;
                document.getElementById('scroll-position').textContent = `Y: ${scrollY}px`;
                
                // Update minimap viewport position
                const viewportEl = document.getElementById('minimap-viewport');
                const viewportPercentage = scrollY / (pageHeight - window.innerHeight);
                const viewportPosition = viewportPercentage * (minimapHeight - viewportEl.offsetHeight);
                viewportEl.style.top = `${viewportPosition}px`;
            });
        }, 2000);
    </script>
</body>
</html>
