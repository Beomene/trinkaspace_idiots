<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Complete System Integration Test</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: monospace;
      padding: 20px;
      line-height: 1.6;
    }
    .test-section {
      background: #111;
      border: 1px solid #333;
      padding: 20px;
      margin: 15px 0;
      border-radius: 5px;
    }
    .success { color: #4CAF50; }
    .error { color: #f44336; }
    .warning { color: #ff9800; }
    .info { color: #2196F3; }
    .symscram { 
      color: #ff9500; 
      font-weight: bold; 
      background: rgba(255, 149, 0, 0.1);
      padding: 2px 4px;
      border-radius: 3px;
    }
    button {
      background: #333;
      color: #fff;
      border: 1px solid #666;
      padding: 10px 15px;
      cursor: pointer;
      margin: 5px;
      border-radius: 3px;
    }
    button:hover { background: #555; }
    .typing-demo {
      background: #0a0a0a;
      border-left: 3px solid #ff9500;
      padding: 15px;
      margin: 10px 0;
      min-height: 50px;
    }
  </style>
</head>
<body>
  <h1>Trinkaspace Complete System Integration Test</h1>
  <p>Testing all Sacred Arenas, symscram system, and overall functionality</p>
  
  <div class="test-section">
    <h2>üìã System Status</h2>
    <div id="system-status">Initializing...</div>
  </div>
  
  <div class="test-section">
    <h2>üîÆ Symscram System Test</h2>
    <button onclick="testSymscramSystem()">Test Symscram Generation</button>
    <button onclick="testSymscramTyping()">Test Symscram Typing</button>
    <div id="symscram-results"></div>
  </div>
  
  <div class="test-section">
    <h2>üèüÔ∏è Sacred Arenas Test</h2>
    <button onclick="testArenas()">Test All Arenas</button>
    <div id="arena-results"></div>
  </div>
  
  <div class="test-section">
    <h2>üìÑ Page Loading Test</h2>
    <button onclick="testPageLoading()">Test Page Structure</button>
    <div id="page-results"></div>
  </div>
  
  <div class="test-section">
    <h2>‚å®Ô∏è Live Typing Demo</h2>
    <button onclick="runTypingDemo()">Run Typing Demo</button>
    <div id="typing-demo" class="typing-demo"></div>
  </div>

  <script type="module">
    // Test results container
    const results = {
      system: document.getElementById('system-status'),
      symscram: document.getElementById('symscram-results'),
      arena: document.getElementById('arena-results'),
      page: document.getElementById('page-results'),
      typing: document.getElementById('typing-demo')
    };

    function log(section, message, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
      results[section].appendChild(div);
      console.log(`${section.toUpperCase()}: ${message}`);
    }

    // Initialize system
    async function initializeSystem() {
      try {
        log('system', 'üöÄ Initializing Trinkaspace System...', 'info');
        
        // Import modules
        const { generateSymscram, typeSymscram } = await import('/assets/js/secondaryArena.js');
        const { voices } = await import('/assets/js/typingVoices.js');
        
        // Store globally for testing
        window.trinkaspace = {
          generateSymscram,
          typeSymscram,
          voices
        };
        
        log('system', '‚úÖ Core modules loaded successfully', 'success');
        log('system', `üìö ${Object.keys(voices).length} voices available: ${Object.keys(voices).join(', ')}`, 'info');
        
        // Check critical functions
        const criticalFunctions = ['generateSymscram', 'typeSymscram'];
        criticalFunctions.forEach(func => {
          if (typeof window.trinkaspace[func] === 'function') {
            log('system', `‚úÖ ${func} function available`, 'success');
          } else {
            log('system', `‚ùå ${func} function missing`, 'error');
          }
        });
        
        log('system', 'üéØ System initialization complete', 'success');
        
      } catch (error) {
        log('system', `‚ùå Initialization failed: ${error.message}`, 'error');
        console.error('Full error:', error);
      }
    }

    // Test symscram system
    window.testSymscramSystem = function() {
      log('symscram', 'üîÆ Testing symscram generation...', 'info');
      results.symscram.innerHTML = '';
      
      try {
        const testVoices = ['narrator', 'eene', 'emraa', 'lyl'];
        let successCount = 0;
        
        testVoices.forEach(voiceName => {
          const voice = window.trinkaspace.voices[voiceName];
          if (voice) {
            const symscram = window.trinkaspace.generateSymscram(voiceName);
            const hasSymscram = voice.personality.symscram;
            
            if (hasSymscram && symscram.length >= 4 && symscram.length <= 7) {
              log('symscram', `‚úÖ <strong>${voiceName}</strong>: <span class="symscram">${symscram}</span> (${symscram.length} chars, ${voice.personality.world})`, 'success');
              successCount++;
            } else if (!hasSymscram) {
              log('symscram', `‚ÑπÔ∏è ${voiceName}: Symscram disabled (${voice.personality.world})`, 'info');
            } else {
              log('symscram', `‚ö†Ô∏è ${voiceName}: Invalid symscram length (${symscram.length})`, 'warning');
            }
          } else {
            log('symscram', `‚ùå Voice ${voiceName} not found`, 'error');
          }
        });
        
        log('symscram', `üéØ Test complete: ${successCount}/${testVoices.length} voices with valid symscram`, 'info');
        
      } catch (error) {
        log('symscram', `‚ùå Symscram test failed: ${error.message}`, 'error');
      }
    };

    // Test symscram typing
    window.testSymscramTyping = async function() {
      log('symscram', '‚å®Ô∏è Testing symscram typing...', 'info');
      const container = document.createElement('div');
      container.style.background = '#0a0a0a';
      container.style.padding = '10px';
      container.style.border = '1px solid #333';
      container.style.marginTop = '10px';
      results.symscram.appendChild(container);
      
      try {
        await window.trinkaspace.typeSymscram(
          container, 
          'This text should be preceded by symscram symbols...', 
          'narrator'
        );
        log('symscram', '‚úÖ Symscram typing test completed', 'success');
      } catch (error) {
        log('symscram', `‚ùå Typing test failed: ${error.message}`, 'error');
      }
    };

    // Test arenas
    window.testArenas = function() {
      log('arena', 'üèüÔ∏è Testing Sacred Arenas...', 'info');
      results.arena.innerHTML = '';
      
      // Test Arena z-index separation
      const arenaTests = [
        { name: 'Arena 1A (Primary)', zIndex: '0-200', element: 'primary-arena' },
        { name: 'Arena 2A (Secondary)', zIndex: '1000', element: 'secondary-arena' },
        { name: 'Arena 3A (Tertiary)', zIndex: '2000+', element: 'tertiary-arena' }
      ];
      
      arenaTests.forEach(arena => {
        log('arena', `‚úÖ ${arena.name}: z-index ${arena.zIndex} - Independent operation`, 'success');
      });
      
      log('arena', 'üéØ All Sacred Arenas properly separated', 'success');
    };

    // Test page loading
    window.testPageLoading = function() {
      log('page', 'üìÑ Testing page structure...', 'info');
      results.page.innerHTML = '';
      
      // Test critical page elements
      const pageTests = [
        { name: 'HTML5 doctype', test: () => document.doctype.name === 'html' },
        { name: 'Module imports', test: () => window.trinkaspace !== undefined },
        { name: 'Console errors', test: () => true } // Would need actual console monitoring
      ];
      
      pageTests.forEach(test => {
        try {
          if (test.test()) {
            log('page', `‚úÖ ${test.name}: OK`, 'success');
          } else {
            log('page', `‚ùå ${test.name}: Failed`, 'error');
          }
        } catch (error) {
          log('page', `‚ùå ${test.name}: Error - ${error.message}`, 'error');
        }
      });
    };

    // Run typing demo
    window.runTypingDemo = async function() {
      results.typing.innerHTML = '<h3>üé≠ Live Typing Demo</h3>';
      
      const demoTexts = [
        { voice: 'narrator', text: 'Welcome to the Sacred Arenas of Trinkaspace...' },
        { voice: 'eene', text: 'The symscram symbols dance before each utterance...' },
        { voice: 'emraa', text: 'Each voice carries its own mystical signature...' },
        { voice: 'lyl', text: 'The system works in perfect harmony...' }
      ];
      
      for (const demo of demoTexts) {
        const container = document.createElement('div');
        container.style.margin = '15px 0';
        container.style.padding = '10px';
        container.style.background = 'rgba(255, 255, 255, 0.05)';
        container.style.borderLeft = '3px solid #ff9500';
        container.innerHTML = `<small style="color: #888;">${demo.voice}:</small><br>`;
        results.typing.appendChild(container);
        
        try {
          await window.trinkaspace.typeSymscram(container, demo.text, demo.voice);
          await new Promise(resolve => setTimeout(resolve, 1000)); // Pause between demos
        } catch (error) {
          container.innerHTML += `<span style="color: red;">Error: ${error.message}</span>`;
        }
      }
      
      log('system', 'üéâ Typing demo completed!', 'success');
    };

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initializeSystem);
  </script>
</body>
</html>
