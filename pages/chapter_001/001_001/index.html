<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trinkaloop Saga - Chapter 1, Page 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/css/core.css">
  <link rel="stylesheet" href="/assets/css/beat-system.css">
  <link rel="stylesheet" href="/assets/css/hud.css">
  <link rel="stylesheet" href="/assets/css/keyboard-navigation.css">
  <link rel="stylesheet" href="/assets/css/quaternaryArena.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
</head>
<body class="story-page">
  <!-- A1 Primary Arena - Dioramas -->
  <div id="trinkaspace-container" tabindex="-1"></div>
  
  <!-- A2 Secondary Arena - Text Elements -->
  <div id="LTT" class="trinkatext left-trinkatext" data-moment="1" data-text="Hello... I'm Eene. I think... I think I'm ready to begin this story." data-voice="eene"></div>
  <div id="RTT" class="trinkatext right-trinkatext" data-moment="4" data-text="*A warm presence appears* Greetings, young one. I am Emraa." data-voice="emraa"></div>
  <div id="UTT" class="trinkatext upper-trinkatext" data-moment="6" data-text="(nervous) Oh... someone's here..." data-voice="eene-subconscious"></div>
  
  <!-- A3 Tertiary Arena - HUD (loads after A1 is ready) -->
  <!-- HUD will be initialized by A4 Director when appropriate -->
  
  <script type="module">
    import TrinkaspaceEngine from '/assets/js/trinkaspaceEngine.js';
    import keyboardNavigation from '/assets/js/keyboardNavigation.js';
    import { typeText } from '/assets/js/secondaryArena.js';
    
    // Make typeText globally available
    window.typeText = typeText;

    // Initialize the engine when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ Initializing Trinkaspace Engine...');
      window.trinkaspaceEngine = new TrinkaspaceEngine({ pageId: '001_001' });
      
      // Initialize keyboard navigation  
      keyboardNavigation.init();
      
      console.log('üé¨ A4 Director will orchestrate the experience');
      console.log('üëë Using Royal Alpha blueprint with pageOrigo system');
    });
    
    // Global sanitization helper
    window.addEventListener('DOMContentLoaded', () => {
      if (typeof marked !== 'undefined' && typeof DOMPurify !== 'undefined') {
        window.sanitizeHTML = function(html) {
          return DOMPurify.sanitize(marked.parse(html));
        };
      }
    });
  </script>
</body>
</html>
      
      // Setup keyboard help button
      const helpButton = document.getElementById('keyboard-help-button');
      if (helpButton) {
        helpButton.addEventListener('click', () => {
          keyboardNavigation.showHelp();
        });
      }
      
      // Setup SCOPEGUARD for development
      window.SCOPEGUARD_ENABLED = true;
      window._scopeguardWarned = {};
    });
    
    // Text-boxes will be loaded from folders (001_001_003, etc.)
    // The textboxes will now be loaded directly by the TrinkaspaceEngine
    // from the page.json elements section

    // ORIGINAL DIORAMA-DEPENDENT CODE (commented out for debugging)
    /*
    // Add text boxes after a delay to ensure dioramas are loaded
    setTimeout(() => {
      console.log('üìù Adding text boxes...');
      
      // Method 1: Using scope-based positioning (loads from 001_001_003 folder)
      placeTextBoxFromScope('001_001_003');
    }, 1000);

    // Add character text boxes after engine is fully loaded
    setTimeout(() => {
      console.log('üé≠ Adding character voices...');
      
      // Eene: Fast typer with frequent quick corrections
    addTextBox({
      id: "eene-intro",
      text: "Hey everyone! I'm Eene and I type really fast but sometimes I make mistakes that I fix right away. The adventure is about to begin and I think we should definitely explore the trinkaloop together!",
      speaker: "Eene",
      voice: "eene",
      anchorTo: "001_001_004",
      offsetY: "12vh",
      align: "left"
    });

    // Emraa: Careful, methodical typer who fixes mistakes in batches
    addTextBox({
      id: "emraa-analysis",
      text: "Greetings. I am Emraa, and I believe this trinkaloop requires careful analysis. We must proceed with deliberate precision to achieve our objectives and understand the underlying mechanisms.",
      speaker: "Emraa",
      voice: "emraa",
      anchorTo: "001_001_006",
      offsetY: "10vh",
      align: "left"
    });

    // Lyl: Slow, dreamy corgi who never corrects mistakes
    addTextBox({
      id: "lyl-dreams",
      text: "oh hello freinds... i am lyl the corgi made of beautiflu white flower petlas... the sunshine feels so nice and peaceful today... maybe we can find some lovely flowers in the gardn later...",
      speaker: "Lyl",
      voice: "lyl",
      anchorTo: "001_001_008",
      offsetY: "8vh",
      align: "left"
    });

    // Narrator: Balanced storytelling voice
    addTextBox({
      id: "narrator-conclusion",
      text: "And so our three heroes prepare for the journey ahead... Each with their own voice, their own way of seeing the world. What mysteries will they uncover in the depths of the trinkaloop?",
      speaker: "Narrator",
      voice: "narrator",
      anchorTo: "001_001_010",
      offsetY: "5vh",
      align: "left"
    });
    }, 1500);
    */
  </script>
  
  <script>
    // Make sure marked and DOMPurify are available globally for textbox rendering
    window.addEventListener('DOMContentLoaded', () => {
      if (typeof marked === 'undefined') {
        console.error('‚ö†Ô∏è marked.js not loaded!');
      }
      if (typeof DOMPurify === 'undefined') {
        console.error('‚ö†Ô∏è DOMPurify not loaded!');
      }
      
      // Add global sanitization helper
      window.sanitizeHTML = function(html) {
        return DOMPurify.sanitize(marked.parse(html));
      };
    });
  </script>
</body>
</html>
